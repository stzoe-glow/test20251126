<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Make Your Magic Spells</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Crimson+Text:ital,wght@1,600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --gryffindor-red: #740001;
            --hogwarts-gold: #d3a625;
            --parchment-bg: #f5e6c8;
            --dark-bg: #0e0e0e;
            --card-size: 100px;
        }

        body {
            font-family: 'Cinzel', serif;
            background-color: var(--dark-bg);
            background-image: radial-gradient(circle at center, #2e2e2e 0%, #000000 100%);
            color: var(--hogwarts-gold);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            text-shadow: 0 0 10px var(--hogwarts-gold);
            margin-bottom: 10px;
            text-align: center;
        }

        /* --- [화면 전환용 스타일] --- */
        .screen {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: opacity 0.5s;
        }
        .hidden { display: none !important; }

        /* --- [1. 입력 화면 스타일] --- */
        .input-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border: 2px solid var(--hogwarts-gold);
            border-radius: 15px;
            text-align: center;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }

        input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--hogwarts-gold);
            color: #fff;
            padding: 10px;
            font-family: 'Crimson Text', serif;
            font-size: 1.1rem;
            width: 40%;
            text-align: center;
        }
        input:focus { outline: none; border-bottom-color: var(--gryffindor-red); }
        input::placeholder { color: rgba(255,255,255,0.4); }

        /* 양피지 느낌의 단어 리스트 */
        .word-list-area {
            background-color: var(--parchment-bg);
            color: #3e2723;
            width: 100%;
            height: 200px;
            overflow-y: auto;
            border-radius: 5px;
            margin: 20px 0;
            padding: 10px;
            font-family: 'Crimson Text', serif;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            list-style: none;
            text-align: left;
        }
        
        .word-item {
            border-bottom: 1px dashed #8d6e63;
            padding: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .delete-btn {
            background: transparent;
            color: #8d6e63;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0 5px;
        }
        .delete-btn:hover { color: red; }

        /* --- [2. 게임 화면 스타일] --- */
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, var(--card-size));
            gap: 15px;
            perspective: 1000px;
            margin-top: 20px;
        }

        .status-bar { margin-bottom: 20px; font-size: 1.2rem; display: flex; gap: 20px;}

        /* --- [공통 버튼 스타일] --- */
        button.action-btn {
            font-family: 'Cinzel', serif;
            background: var(--gryffindor-red);
            color: var(--hogwarts-gold);
            border: 2px solid var(--hogwarts-gold);
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 30px;
            transition: 0.3s;
            margin: 5px;
        }
        button.action-btn:hover {
            background-color: #ae0001;
            box-shadow: 0 0 15px var(--hogwarts-gold);
            transform: scale(1.05);
        }

        /* --- [카드 스타일] --- */
        .card {
            width: var(--card-size);
            height: calc(var(--card-size) * 1.3);
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }
        .card.flip { transform: rotateY(180deg); }
        .front, .back {
            width: 100%; height: 100%; position: absolute;
            border-radius: 8px; display: flex; justify-content: center; align-items: center;
            backface-visibility: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            border: 2px solid #5a4a28;
        }
        .front {
            background-color: var(--gryffindor-red);
            /* 격자 패턴 */
            background-image: linear-gradient(45deg, rgba(0,0,0,0.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.1) 75%), 
                              linear-gradient(45deg, rgba(0,0,0,0.1) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.1) 75%);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            color: var(--hogwarts-gold); font-size: 2.5rem;
        }
        .back {
            background-color: var(--parchment-bg); color: #3e2723;
            transform: rotateY(180deg); font-family: 'Crimson Text', serif;
            font-weight: bold; font-size: 1.1rem; text-align: center; padding: 5px; word-break: keep-all;
        }
        .card.matched .back {
            border: 3px solid var(--hogwarts-gold);
            box-shadow: 0 0 15px var(--hogwarts-gold);
            background-color: #fff8e1;
        }

        /* 모바일 대응 */
        @media (max-width: 600px) {
            :root { --card-size: 70px; }
            .game-board { gap: 10px; }
            .input-group { flex-direction: column; }
            input { width: 100%; box-sizing: border-box;}
        }
    </style>
</head>
<body>

    <h1>⚡ Magic Memory ⚡</h1>

    <!-- [1] 단어 입력 화면 -->
    <div id="setup-screen" class="screen">
        <div class="input-container">
            <h3 style="margin-top:0;">Create Your Spell Book</h3>
            <p style="font-size:0.9rem; font-family:'Crimson Text'; color:#ccc;">
                Enter English word and Meaning below.
            </p>

            <div class="input-group">
                <input type="text" id="input-en" placeholder="English (e.g. Magic)">
                <input type="text" id="input-ko" placeholder="Meaning (e.g. 마법)">
            </div>
            
            <button class="action-btn" onclick="addWord()">Add Spell</button>

            <!-- 추가된 단어 리스트 표시 -->
            <ul id="word-list" class="word-list-area">
                <li style="text-align:center; color:#888; padding-top:20px;">
                    The scroll is empty...
                </li>
            </ul>

            <button class="action-btn" onclick="prepareGame()" style="width:100%; margin-top:10px; background-color:var(--hogwarts-gold); color:#000;">
                Start Magic ✨
            </button>
        </div>
    </div>

    <!-- [2] 게임 플레이 화면 -->
    <div id="game-screen" class="screen hidden">
        <div class="status-bar">
            <span>Remains: <b id="pairs-left" style="color:white">0</b></span>
            <button class="action-btn" onclick="stopGame()" style="padding:5px 15px; font-size:0.8rem;">Edit List</button>
        </div>
        <div class="game-board" id="game-board"></div>
    </div>

    <script>
        // --- 데이터 변수 ---
        let myWords = []; // 사용자가 추가한 단어가 여기에 저장됨
        
        // --- DOM 요소 ---
        const setupScreen = document.getElementById('setup-screen');
        const gameScreen = document.getElementById('game-screen');
        const wordListUI = document.getElementById('word-list');
        const inputEn = document.getElementById('input-en');
        const inputKo = document.getElementById('input-ko');
        const gameBoard = document.getElementById('game-board');
        const pairsLeftDisplay = document.getElementById('pairs-left');

        // 엔터키 입력 이벤트 (편의성)
        inputKo.addEventListener("keyup", function(event) {
            if (event.key === "Enter") addWord();
        });

        // 1. 단어 추가하기
        function addWord() {
            const en = inputEn.value.trim();
            const ko = inputKo.value.trim();

            if (!en || !ko) {
                alert("Please enter both word and meaning!");
                return;
            }

            // 리스트에 추가
            myWords.push({ en: en, ko: ko });
            
            // 입력창 비우기 및 포커스 이동
            inputEn.value = "";
            inputKo.value = "";
            inputEn.focus();

            renderList();
        }

        // 2. 리스트 화면에 그리기
        function renderList() {
            wordListUI.innerHTML = ""; // 초기화

            if (myWords.length === 0) {
                wordListUI.innerHTML = '<li style="text-align:center; color:#888; padding-top:20px;">The scroll is empty...</li>';
                return;
            }

            myWords.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'word-item';
                li.innerHTML = `
                    <span><b>${item.en}</b> : ${item.ko}</span>
                    <button class="delete-btn" onclick="removeWord(${index})">✕</button>
                `;
                wordListUI.appendChild(li);
            });
        }

        // 3. 단어 삭제하기
        function removeWord(index) {
            myWords.splice(index, 1);
            renderList();
        }

        // 4. 게임 준비 및 화면 전환
        function prepareGame() {
            if (myWords.length < 2) {
                alert("You need at least 2 words to start magic!");
                return;
            }
            
            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            initGame();
        }

        function stopGame() {
            if(confirm("Stop magic and go back to scroll?")) {
                gameScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');
            }
        }

        // --- 여기서부터는 기존 게임 로직과 유사함 ---
        let hasFlippedCard = false;
        let lockBoard = false;
        let firstCard, secondCard;
        let pairsLeft = 0;

        function initGame() {
            gameBoard.innerHTML = '';
            hasFlippedCard = false;
            lockBoard = false;
            firstCard = null;
            secondCard = null;

            // myWords 데이터를 기반으로 카드 생성
            const doubleWords = [];
            myWords.forEach(item => {
                doubleWords.push({ text: item.en, pairId: item.en });
                doubleWords.push({ text: item.ko, pairId: item.en });
            });

            pairsLeft = myWords.length;
            pairsLeftDisplay.innerText = pairsLeft;

            doubleWords.sort(() => 0.5 - Math.random());

            // 카드 개수에 따라 그리드 조정 (너무 많으면 자동 줄바꿈 되지만 보기 좋게)
            // 기본 CSS grid 사용

            doubleWords.forEach(data => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.pairId = data.pairId;

                const frontFace = document.createElement('div');
                frontFace.classList.add('front');
                frontFace.innerText = "⚡";

                const backFace = document.createElement('div');
                backFace.classList.add('back');
                backFace.innerText = data.text;

                card.appendChild(frontFace);
                card.appendChild(backFace);
                card.addEventListener('click', flipCard);
                
                gameBoard.appendChild(card);
            });
        }

        function flipCard() {
            if (lockBoard) return;
            if (this === firstCard) return;

            this.classList.add('flip');

            if (!hasFlippedCard) {
                hasFlippedCard = true;
                firstCard = this;
                return;
            }

            secondCard = this;
            checkForMatch();
        }

        function checkForMatch() {
            let isMatch = firstCard.dataset.pairId === secondCard.dataset.pairId;
            isMatch ? disableCards() : unflipCards();
        }

        function disableCards() {
            firstCard.removeEventListener('click', flipCard);
            secondCard.removeEventListener('click', flipCard);
            
            firstCard.classList.add('matched');
            secondCard.classList.add('matched');

            pairsLeft--;
            pairsLeftDisplay.innerText = pairsLeft;

            resetBoard();

            if (pairsLeft === 0) {
                setTimeout(() => alert("✨ Mischief Managed! ✨\n완벽하게 외우셨군요!"), 500);
            }
        }

        function unflipCards() {
            lockBoard = true;
            setTimeout(() => {
                firstCard.classList.remove('flip');
                secondCard.classList.remove('flip');
                resetBoard();
            }, 1000);
        }

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }
    </script>
</body>
</html>
