<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ê·¸ë„¤ìŠ¤ì˜ ìœ ë‹ˆì½˜ êµ¬êµ¬ë‹¨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #ffe6f2; /* ì—°í•œ í•‘í¬ ë°°ê²½ */
            font-family: 'Jua', sans-serif; /* ê·€ì—¬ìš´ í°íŠ¸ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-image: radial-gradient(#fff0f5 20%, #ffe6f2 80%);
        }

        /* ê²Œì„ í™”ë©´ */
        canvas {
            background-color: rgba(255, 255, 255, 0.6);
            border: 8px solid #ff99cc; /* ì§„í•œ í•‘í¬ í…Œë‘ë¦¬ */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
            display: block;
        }

        /* í•˜ë‹¨ ì…ë ¥ UI */
        #ui-container {
            position: absolute;
            bottom: 30px;
            width: 600px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        /* ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ - ì•„ê·¸ë„¤ìŠ¤ ì˜· ìƒ‰ê¹”(ë…¸ë‘) í¬ì¸íŠ¸ */
        #answer-input {
            width: 200px;
            padding: 15px;
            font-size: 30px;
            font-family: 'Jua', sans-serif;
            border: 4px solid #fecb00; /* ë…¸ë€ìƒ‰ í…Œë‘ë¦¬ */
            border-radius: 50px;
            outline: none;
            text-align: center;
            background-color: white;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        #answer-input:focus {
            border-color: #ff69b4; /* í¬ì»¤ìŠ¤ì‹œ í•«í•‘í¬ */
        }

        /* ì ìˆ˜íŒ */
        #score-board {
            position: absolute;
            top: 20px;
            font-size: 28px;
            color: #ff69b4;
            background: white;
            padding: 10px 30px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(255, 182, 193, 0.5);
            z-index: 10;
        }

        /* ì˜¤ë²„ë ˆì´ (ì‹œì‘/ì¢…ë£Œ í™”ë©´) */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            backdrop-filter: blur(5px);
        }

        h1 {
            font-size: 60px;
            color: #ff69b4;
            text-shadow: 3px 3px 0px #fecb00;
            margin-bottom: 10px;
        }

        p { color: #555; font-size: 20px; }
        
        button {
            padding: 15px 50px;
            font-size: 30px;
            font-family: 'Jua', sans-serif;
            cursor: pointer;
            background: #ff69b4;
            color: white;
            border: none;
            border-radius: 50px;
            margin-top: 30px;
            transition: transform 0.2s, background 0.2s;
            box-shadow: 0 5px 0 #db4c93;
        }
        button:hover { 
            background: #ff85c2; 
            transform: scale(1.05);
        }
        button:active {
            box-shadow: none;
            transform: translateY(5px);
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="score-board">
        ğŸ¦„ ëª¨ì€ ìœ ë‹ˆì½˜: <span id="score-val">0</span>ë§ˆë¦¬
    </div>

    <canvas id="gameCanvas" width="600" height="800"></canvas>

    <div id="ui-container">
        <input type="number" id="answer-input" placeholder="ì •ë‹µ!" autocomplete="off">
    </div>

    <div id="overlay">
        <h1>IT'S SO FLUFFY!</h1>
        <p>ë‚´ë ¤ì˜¤ëŠ” ìœ ë‹ˆì½˜ êµ¬êµ¬ë‹¨ì„ ë§ì¶°ì£¼ì„¸ìš”!</p>
        <p id="final-score" style="display:none; font-size: 30px; color: #ff69b4; font-weight:bold; margin-top:20px;"></p>
        <button id="start-btn">ê²Œì„ ì‹œì‘ ğŸ¦„</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const inputField = document.getElementById('answer-input');
        const scoreEl = document.getElementById('score-val');
        const overlay = document.getElementById('overlay');
        const startBtn = document.getElementById('start-btn');
        const finalScoreText = document.getElementById('final-score');
        const titleText = document.querySelector('h1');

        let problems = [];
        let particles = []; // ë°˜ì§ì´ íš¨ê³¼
        let score = 0;
        let pileHeight = 0; // ìŒ“ì¸ ë†’ì´
        let gameRunning = false;
        let frameCount = 0;
        let spawnRate = 80;
        let difficulty = 1;

        // ìœ ë‹ˆì½˜ í´ë˜ìŠ¤
        class Unicorn {
            constructor() {
                this.a = Math.floor(Math.random() * 8) + 2; 
                this.b = Math.floor(Math.random() * 9) + 1;
                this.question = `${this.a} x ${this.b}`;
                this.answer = this.a * this.b;
                
                this.x = Math.random() * (canvas.width - 120) + 60;
                this.y = -60;
                this.speed = (Math.random() * 1.0 + 0.5) * difficulty;
                
                // ìœ ë‹ˆì½˜ ì´ëª¨ì§€ í¬ê¸° ë° í”ë“¤ë¦¼ íš¨ê³¼ ë³€ìˆ˜
                this.size = 60;
                this.wobble = Math.random() * Math.PI * 2;
            }

            update() {
                this.y += this.speed;
                this.wobble += 0.05; // ë‘¥ì‹¤ë‘¥ì‹¤ ì›€ì§ì„
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                // ì¢Œìš°ë¡œ ì‚´ì§ í”ë“¤ë¦¬ê²Œ
                ctx.rotate(Math.sin(this.wobble) * 0.1);

                // 1. ìœ ë‹ˆì½˜ ê·¸ë¦¬ê¸° (ì´ëª¨ì§€ í™œìš©)
                ctx.font = "80px Arial"; 
                ctx.textAlign = "center";
                ctx.fillText("ğŸ¦„", 0, 10);

                // 2. ë§í’ì„  ê·¸ë¦¬ê¸° (ë¬¸ì œ ë°°ê²½)
                ctx.fillStyle = "white";
                ctx.beginPath();
                ctx.arc(0, -50, 40, 0, Math.PI*2);
                ctx.fill();
                ctx.strokeStyle = "#ff99cc";
                ctx.lineWidth = 3;
                ctx.stroke();

                // 3. ë¬¸ì œ í…ìŠ¤íŠ¸
                ctx.fillStyle = "#ff69b4";
                ctx.font = "bold 30px 'Jua', sans-serif";
                ctx.fillText(this.question, 0, -40);

                ctx.restore();
            }
        }

        // ë°˜ì§ì´ íš¨ê³¼ í´ë˜ìŠ¤
        class Sparkle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 5 + 2;
                this.speedX = Math.random() * 4 - 2;
                this.speedY = Math.random() * 4 - 2;
                this.alpha = 1;
                this.color = `hsl(${Math.random()*60 + 300}, 100%, 70%)`; // í•‘í¬~ë³´ë¼ ê³„ì—´
            }
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.alpha -= 0.03;
            }
            draw() {
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            }
        }

        function gameLoop() {
            if (!gameRunning) return;

            // ë°°ê²½ ì§€ìš°ê¸°
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // 1. ë°”ë‹¥(ìŒ“ì¸ ìœ ë‹ˆì½˜ë“¤/êµ¬ë¦„) ê·¸ë¦¬ê¸°
            let cloudHeight = (pileHeight / 100) * canvas.height;
            
            // ê·¸ë¼ë°ì´ì…˜ êµ¬ë¦„ íš¨ê³¼
            let gradient = ctx.createLinearGradient(0, canvas.height - cloudHeight, 0, canvas.height);
            gradient.addColorStop(0, "rgba(255, 255, 255, 0.9)");
            gradient.addColorStop(1, "#ffccdd");

            ctx.fillStyle = gradient;
            
            // êµ¬ë¦„ì´ ëª½ê¸€ëª½ê¸€í•˜ê²Œ ë³´ì´ë„ë¡ ì› ê·¸ë¦¬ê¸°
            if (cloudHeight > 0) {
                ctx.beginPath();
                ctx.moveTo(0, canvas.height);
                ctx.lineTo(0, canvas.height - cloudHeight);
                // ëª½ê¸€ëª½ê¸€ ë¼ì¸
                for (let i = 0; i <= canvas.width; i+=40) {
                    ctx.quadraticCurveTo(i + 20, canvas.height - cloudHeight - 20, i + 40, canvas.height - cloudHeight);
                }
                ctx.lineTo(canvas.width, canvas.height);
                ctx.fill();
            }

            // 2. ë¬¸ì œ ìƒì„±
            frameCount++;
            if (frameCount % Math.floor(spawnRate) === 0) {
                problems.push(new Unicorn());
                if (spawnRate > 30) spawnRate -= 0.2;
                difficulty += 0.0005;
            }

            // 3. ë¬¸ì œ ì—…ë°ì´íŠ¸
            for (let i = 0; i < problems.length; i++) {
                let p = problems[i];
                p.update();
                p.draw();

                // ë°”ë‹¥(êµ¬ë¦„)ì— ë‹¿ì•˜ì„ ë•Œ
                if (p.y > canvas.height - cloudHeight - 40) {
                    pileHeight += 10; // ë†’ì´ ì¦ê°€
                    problems.splice(i, 1);
                    i--;
                    
                    // í™”ë©´ í”ë“¤ë¦¼ íš¨ê³¼ (ê·€ì—½ê²Œ)
                    canvas.style.transform = "rotate(1deg)";
                    setTimeout(() => canvas.style.transform = "rotate(-1deg)", 50);
                    setTimeout(() => canvas.style.transform = "none", 100);
                }
            }

            // 4. ë°˜ì§ì´ ì´í™íŠ¸ ì—…ë°ì´íŠ¸
            for (let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].alpha <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }

            // 5. ê²Œì„ ì˜¤ë²„ ì²´í¬
            if (pileHeight >= 100) {
                gameOver();
                return;
            }

            requestAnimationFrame(gameLoop);
        }

        function checkAnswer() {
            const userAnswer = parseInt(inputField.value);
            if (isNaN(userAnswer)) return;

            for (let i = 0; i < problems.length; i++) {
                if (problems[i].answer === userAnswer) {
                    // ë°˜ì§ì´ ìƒì„±
                    for(let k=0; k<10; k++) {
                        particles.push(new Sparkle(problems[i].x, problems[i].y));
                    }
                    
                    problems.splice(i, 1);
                    score += 1;
                    scoreEl.innerText = score;
                    
                    // êµ¬ë¦„ ì¡°ê¸ˆ ë‚®ì¶°ì£¼ê¸°
                    if(pileHeight > 0) pileHeight = Math.max(0, pileHeight - 3);
                    break; 
                }
            }
            inputField.value = "";
        }

        function startGame() {
            score = 0;
            pileHeight = 0;
            difficulty = 1;
            spawnRate = 80;
            problems = [];
            particles = [];
            gameRunning = true;
            
            scoreEl.innerText = 0;
            overlay.classList.add('hidden');
            inputField.focus();
            
            gameLoop();
        }

        function gameOver() {
            gameRunning = false;
            overlay.classList.remove('hidden');
            titleText.innerText = "ë„ˆë¬´ ê½‰ ì°¼ì–´!";
            startBtn.innerText = "ë‹¤ì‹œ í•˜ê¸°";
            finalScoreText.style.display = "block";
            finalScoreText.innerText = `ì´ ${score}ë§ˆë¦¬ì˜ ìœ ë‹ˆì½˜ì„ êµ¬í–ˆì–´!`;
        }

        startBtn.addEventListener('click', startGame);

        inputField.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
        
        canvas.addEventListener('click', () => inputField.focus());

    </script>
</body>
</html>